{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport type { NextRequest } from 'next/server';\r\n\r\n// Strict role-based route protection - each role can ONLY access their own routes\r\nconst roleRoutes: Record<string, string[]> = {\r\n  '/dashboard/admin': ['admin'],\r\n  '/dashboard/technician': ['technician'],\r\n  '/dashboard/worker': ['worker'],\r\n};\r\n\r\nexport function middleware(request: NextRequest) {\r\n  const { pathname } = request.nextUrl;\r\n\r\n  // Check if the path requires role-based access\r\n  for (const [route, allowedRoles] of Object.entries(roleRoutes)) {\r\n    if (pathname.startsWith(route)) {\r\n      const userRole = request.cookies.get('userRole')?.value;\r\n      const token = request.cookies.get('token')?.value;\r\n\r\n      // If no token, redirect to login\r\n      if (!token) {\r\n        const loginUrl = new URL('/login', request.url);\r\n        loginUrl.searchParams.set('redirect', pathname);\r\n        return NextResponse.redirect(loginUrl);\r\n      }\r\n\r\n      // Strict role check: If user role doesn't match exactly, redirect to their own dashboard\r\n      if (userRole && !allowedRoles.includes(userRole)) {\r\n        // Redirect to user's own dashboard based on their role\r\n        let redirectPath = '/dashboard/worker';\r\n        if (userRole === 'admin') {\r\n          redirectPath = '/dashboard/admin';\r\n        } else if (userRole === 'technician') {\r\n          redirectPath = '/dashboard/technician';\r\n        }\r\n        // Return forbidden response and let ProtectedRoute handle the UI\r\n        const response = NextResponse.redirect(new URL(redirectPath, request.url));\r\n        response.headers.set('x-forbidden', 'true');\r\n        return response;\r\n      }\r\n    }\r\n  }\r\n\r\n  return NextResponse.next();\r\n}\r\n\r\nexport const config = {\r\n  matcher: [\r\n    '/dashboard/:path*',\r\n  ],\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAGA,kFAAkF;AAClF,MAAM,aAAuC;IAC3C,oBAAoB;QAAC;KAAQ;IAC7B,yBAAyB;QAAC;KAAa;IACvC,qBAAqB;QAAC;KAAS;AACjC;AAEO,SAAS,WAAW,OAAoB;IAC7C,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,+CAA+C;IAC/C,KAAK,MAAM,CAAC,OAAO,aAAa,IAAI,OAAO,OAAO,CAAC,YAAa;QAC9D,IAAI,SAAS,UAAU,CAAC,QAAQ;YAC9B,MAAM,WAAW,QAAQ,OAAO,CAAC,GAAG,CAAC,aAAa;YAClD,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,UAAU;YAE5C,iCAAiC;YACjC,IAAI,CAAC,OAAO;gBACV,MAAM,WAAW,IAAI,IAAI,UAAU,QAAQ,GAAG;gBAC9C,SAAS,YAAY,CAAC,GAAG,CAAC,YAAY;gBACtC,OAAO,gMAAY,CAAC,QAAQ,CAAC;YAC/B;YAEA,yFAAyF;YACzF,IAAI,YAAY,CAAC,aAAa,QAAQ,CAAC,WAAW;gBAChD,uDAAuD;gBACvD,IAAI,eAAe;gBACnB,IAAI,aAAa,SAAS;oBACxB,eAAe;gBACjB,OAAO,IAAI,aAAa,cAAc;oBACpC,eAAe;gBACjB;gBACA,iEAAiE;gBACjE,MAAM,WAAW,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,cAAc,QAAQ,GAAG;gBACxE,SAAS,OAAO,CAAC,GAAG,CAAC,eAAe;gBACpC,OAAO;YACT;QACF;IACF;IAEA,OAAO,gMAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;KACD;AACH"}}]
}