{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/houss/Desktop/smartMaint/frontend/src/proxy.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport type { NextRequest } from 'next/server';\n\n// Role-based route protection\nconst roleRoutes: Record<string, string[]> = {\n  '/dashboard/admin': ['admin'],\n  '/dashboard/technician': ['technician'],\n  '/dashboard/worker': ['worker'],\n  // Shared: any authenticated role can create a ticket\n  '/dashboard/create-ticket': ['admin', 'technician', 'worker'],\n};\n\nexport function proxy(request: NextRequest) {\n  const { pathname } = request.nextUrl;\n\n  for (const [route, allowedRoles] of Object.entries(roleRoutes)) {\n    if (pathname.startsWith(route)) {\n      const userRole = request.cookies.get('userRole')?.value;\n      const token = request.cookies.get('token')?.value;\n\n      if (!token) {\n        const loginUrl = new URL('/login', request.url);\n        loginUrl.searchParams.set('redirect', pathname);\n        return NextResponse.redirect(loginUrl);\n      }\n\n      if (userRole && !allowedRoles.includes(userRole)) {\n        let redirectPath = '/dashboard/worker';\n        if (userRole === 'admin' || userRole === 'superadmin') redirectPath = '/dashboard/admin';\n        else if (userRole === 'technician') redirectPath = '/dashboard/technician';\n        const response = NextResponse.redirect(new URL(redirectPath, request.url));\n        response.headers.set('x-forbidden', 'true');\n        return response;\n      }\n\n      return NextResponse.next();\n    }\n  }\n\n  return NextResponse.next();\n}\n\nexport const config = {\n  matcher: [\n    '/dashboard/:path*',\n  ],\n};\n"],"names":[],"mappings":";;;;;;AAAA;;AAGA,8BAA8B;AAC9B,MAAM,aAAuC;IAC3C,oBAAoB;QAAC;KAAQ;IAC7B,yBAAyB;QAAC;KAAa;IACvC,qBAAqB;QAAC;KAAS;IAC/B,qDAAqD;IACrD,4BAA4B;QAAC;QAAS;QAAc;KAAS;AAC/D;AAEO,SAAS,MAAM,OAAoB;IACxC,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,KAAK,MAAM,CAAC,OAAO,aAAa,IAAI,OAAO,OAAO,CAAC,YAAa;QAC9D,IAAI,SAAS,UAAU,CAAC,QAAQ;YAC9B,MAAM,WAAW,QAAQ,OAAO,CAAC,GAAG,CAAC,aAAa;YAClD,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,UAAU;YAE5C,IAAI,CAAC,OAAO;gBACV,MAAM,WAAW,IAAI,IAAI,UAAU,QAAQ,GAAG;gBAC9C,SAAS,YAAY,CAAC,GAAG,CAAC,YAAY;gBACtC,OAAO,8IAAY,CAAC,QAAQ,CAAC;YAC/B;YAEA,IAAI,YAAY,CAAC,aAAa,QAAQ,CAAC,WAAW;gBAChD,IAAI,eAAe;gBACnB,IAAI,aAAa,WAAW,aAAa,cAAc,eAAe;qBACjE,IAAI,aAAa,cAAc,eAAe;gBACnD,MAAM,WAAW,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,cAAc,QAAQ,GAAG;gBACxE,SAAS,OAAO,CAAC,GAAG,CAAC,eAAe;gBACpC,OAAO;YACT;YAEA,OAAO,8IAAY,CAAC,IAAI;QAC1B;IACF;IAEA,OAAO,8IAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;KACD;AACH"}}]
}